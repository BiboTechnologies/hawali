import{initializeApp}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js";import{getStorage,ref as storageRef,uploadBytes,getDownloadURL}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-storage.js";import{getDatabase,ref,remove,push,get,update,onValue,child,set}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-database.js";import{getAuth,onAuthStateChanged,sendPasswordResetEmail,sendEmailVerification,createUserWithEmailAndPassword,signInWithEmailAndPassword,GoogleAuthProvider,signInWithPopup}from"https://www.gstatic.com/firebasejs/9.0.2/firebase-auth.js";const firebaseConfig={apiKey:"AIzaSyAisBpwnYt14S4NiLbcOiAhdINsqwSYJiI",authDomain:"aleveltv-75194.firebaseapp.com",databaseURL:"https://aleveltv-75194-default-rtdb.firebaseio.com",projectId:"aleveltv-75194",storageBucket:"aleveltv-75194.appspot.com",messagingSenderId:"440342498130",appId:"1:440342498130:web:20e2eb670b1cb2c39cc88b",measurementId:"G-VTR1KGT4CW"};const app=initializeApp(firebaseConfig);const database=getDatabase(app);const auth=getAuth(app);document.addEventListener("DOMContentLoaded",function(){const hasShownPopup=localStorage.getItem("hasShownPopup");if(!hasShownPopup){const overlay10=document.getElementById("overlay10");const welcomePopup=document.getElementById("welcomePopup");overlay10.style.display="block";welcomePopup.style.display="block";setTimeout(()=>{welcomePopup.classList.remove("fade-in")},100);localStorage.setItem("hasShownPopup",true)}});function closeWelcomePopup(){const overlay10=document.getElementById("overlay10");const welcomePopup=document.getElementById("welcomePopup");overlay10.style.display="none";welcomePopup.style.display="none"}window.addEventListener("popstate",closeWelcomePopup);document.getElementById("subscribeButton").addEventListener("click",subscribeToFirebase);document.getElementById("closeButton").addEventListener("click",closeWelcomePopup);function subscribeToFirebase(){var email=document.getElementById("email").value;if(email.trim()===""){alert("Please enter your email.");return}document.getElementById("subscribeButton").style.display="none";document.getElementById("spinner").style.display="inline-block";const emailsRef=ref(database,"subscribedEmails");push(emailsRef,email).then(()=>{document.getElementById("spinner").style.display="none";document.getElementById("thankYouMessage").style.display="block";replaceContentWithSuccessMessage();setTimeout(()=>{closeWelcomePopup()},1e3)})["catch"](error=>{console.error("Error submitting email to Firebase:",error);document.getElementById("spinner").style.display="none";alert("There was an error subscribing. Please try again.")})}function replaceContentWithSuccessMessage(){document.getElementById("subscriptionContent").innerHTML=""}function createCart(){const cartDiv=document.createElement("div");cartDiv.id="cart";cartDiv.classList.add("cart");const cartCountSpan=document.createElement("span");cartCountSpan.id="cart-count";const cartButtonsDiv=document.createElement("div");cartButtonsDiv.id="cart-buttons";const openCartBtn=document.createElement("button");openCartBtn.id="open-cart-btn";openCartBtn.innerHTML='<i class="fa fa-shopping-cart"></i>';const closeCartBtn=document.createElement("button");closeCartBtn.id="close-cart-btn";closeCartBtn.innerHTML='<i class="fa fa-times"></i>';cartButtonsDiv.appendChild(openCartBtn);cartButtonsDiv.appendChild(closeCartBtn);const cartContentDiv=document.createElement("div");cartContentDiv.id="cart-content";const cartItemsDiv=document.createElement("div");cartItemsDiv.id="cart-items";const totalPriceParagraph=document.createElement("p");totalPriceParagraph.id="total-price";const checkoutBtn=document.createElement("button");checkoutBtn.id="checkout-btn";checkoutBtn.innerHTML='<i class="fas fa-shopping-cart"></i> Checkout';const buttonAndTotalContainer=document.createElement("div");buttonAndTotalContainer.classList.add("button-and-total-container");cartContentDiv.appendChild(cartItemsDiv);cartContentDiv.appendChild(buttonAndTotalContainer);buttonAndTotalContainer.appendChild(totalPriceParagraph);buttonAndTotalContainer.appendChild(checkoutBtn);cartDiv.appendChild(cartCountSpan);cartDiv.appendChild(cartButtonsDiv);cartDiv.appendChild(cartContentDiv);const cartContainer=document.getElementById("cart-container");cartContainer.appendChild(cartDiv);if(isCartEmpty()){cartDiv.style.display="none"}}function isCartEmpty(){const cartItems=document.getElementById("cart-items");return cartItems.children.length===0}document.addEventListener("DOMContentLoaded",()=>{createCart();window.addEventListener("scroll",()=>{const cart=document.getElementById("cart");const distanceFromTop=window.pageYOffset||document.documentElement.scrollTop;const scrollThreshold=200;if(distanceFromTop>scrollThreshold){cart.style.display="block";setTimeout(()=>{cart.style.opacity="1"},10)}else{cart.style.opacity="0";setTimeout(()=>{cart.style.display="none"},300)}});let userData={};async function showPopupWithUserDetails(){const user=auth.currentUser;if(!user){console.log("User not authenticated");const messageContainer=document.getElementById("messageContainer");const messageContent=document.getElementById("messageContent");const overlay2=document.getElementById("overlay6");messageContent.innerHTML=`
          <div id="companyLogo" class="company-logo">
              <img src="bibo-phone-spare-world-logo-zip-file/png/logo-black.png" alt="Company Logo">
          </div>
          <p>You are not signed in. Please sign in to access your account.</p>
          <button id="loginButton" class="login-button">
              <i class="fa fa-sign-in"></i> Login
          </button>
      `;messageContainer.classList.add("fade-in");messageContainer.style.display="flex";overlay2.style.display="block";const loginButton=document.getElementById("loginButton");loginButton.addEventListener("click",function(){window.location.href="login.html"});return}const overlay2=document.getElementById("overlay6");overlay2.style.display="block";const loader=document.getElementById("loader");loader.style.display="block";const userDetails=JSON.parse(localStorage.getItem("userDetails"));const popup=document.getElementById("popup");popup.style.display="block";popup.classList.add("fade-in");const userDetailsElement=document.getElementById("userDetails");userDetailsElement.innerHTML=`
      <div class="user-info">
          <p class="accountt"> Account Details </p>
          <p>Email: ${userDetails.email}</p>
      </div>
  `;const userId=userDetails.uid;const userRef=ref(database,"users/"+userId);try{const snapshot=await get(userRef);if(snapshot.exists()){const userData=snapshot.val();userDetailsElement.innerHTML+=`
              <table class="additional-info-table">
                  <tr>
                      <th>First Name</th>
                      <td>${userData.firstName||"N/A"}</td>
                  </tr>
                  <tr>
                      <th>Last Name</th>
                      <td>${userData.lastName||"N/A"}</td>
                  </tr>
                  <tr>
                      <th>Telephone</th>
                      <td>${userData.telephone||"N/A"}</td>
                  </tr>
                  <tr>
                      <th>Date of Birth</th>
                      <td>${userData.dob||"N/A"}</td>
                  </tr>
              </table>
          `;loader.style.display="none";const profilePictureElement=document.getElementById("profilePicture");if(user.photoURL){profilePictureElement.src=user.photoURL;profilePictureElement.style.display="block"}else{profilePictureElement.src="img/profile.png";profilePictureElement.style.display="block"}}else{userDetailsElement.innerHTML+=`<p>No user details found.</p>`}}catch(error){console.error("Error fetching user details from Firebase:",error.message)}document.getElementById("popup").style.display="block";document.body.classList.add("no-scroll")}onAuthStateChanged(auth,async user=>{if(user){}else{console.log("User signed out")}});document.getElementById("closePopupBtn").addEventListener("click",function(){closePopup()});function closePopup(){document.getElementById("popup").style.display="none";document.getElementById("overlay6").style.display="none";document.body.classList.remove("no-scroll")}window.addEventListener("popstate",closePopup);document.getElementById("logoutBtn").addEventListener("click",function(){showLogoutConfirmationPopup()});function showLogoutConfirmationPopup(){const confirmationPopup=document.getElementById("confirmationPopup");const overlay=document.getElementById("overlay3");confirmationPopup.style.display="block";overlay.style.display="block";const yesButton=document.getElementById("confirmYesBtn");const noButton=document.getElementById("confirmNoBtn");yesButton.addEventListener("click",handleLogoutConfirmation);noButton.addEventListener("click",closeLogoutConfirmationPopup)}function handleLogoutConfirmation(){const overlay2=document.getElementById("overlay2");auth.signOut().then(()=>{showLoggedOutMessage();closePopup();closeLogoutConfirmationPopup();location.reload()})["catch"](error=>{console.error("Error logging out:",error.message)})}function closeLogoutConfirmationPopup(){const confirmationPopup=document.getElementById("confirmationPopup");const overlay=document.getElementById("overlay3");confirmationPopup.style.display="none";overlay.style.display="none";const yesButton=document.getElementById("confirmYesBtn");const noButton=document.getElementById("confirmNoBtn");yesButton.removeEventListener("click",handleLogoutConfirmation);noButton.removeEventListener("click",closeLogoutConfirmationPopup)}window.addEventListener("popstate",closeLogoutConfirmationPopup);function showLoggedOutMessage(){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`User Logged out!`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}document.getElementById("accountLink").addEventListener("click",async function(event){event.preventDefault();await showPopupWithUserDetails()});function addClosePopupEventListener(){document.getElementById("closePopupBtn").addEventListener("click",function(){const overlay=document.getElementById("overlay");overlay.style.display="none";const popup=document.getElementById("popup");popup.style.display="none";popup.classList.remove("fade-in");document.body.classList.remove("no-scroll")})}window.addEventListener("popstate",function(event){addClosePopupEventListener()});const checkoutBtn=document.getElementById("checkout-btn");checkoutBtn.addEventListener("click",()=>{const cartItems=document.getElementsByClassName("cart-item");const orderSummary=[];for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const productName=cartItem.querySelector(".product-details h5").innerText;const price=parseFloat(cartItem.querySelector(".product-details h4").dataset.price);const quantity=parseInt(cartItem.querySelector(".quantity-input").value);const total=quantity*price;const isWholesale=cartItem.querySelector(".toggle-switch").checked;orderSummary.push({productName:productName,price:price,quantity:quantity,total:total,isWholesale:isWholesale})}const cartTotal=orderSummary.reduce((acc,item)=>acc+item.total,0);const popupContent=document.createElement("div");popupContent.classList.add("popup-content");const title=document.createElement("h4");title.innerText="Order Summary";popupContent.appendChild(title);const orderTable=document.createElement("table");orderTable.classList.add("order-table");const tableHeader=document.createElement("tr");tableHeader.innerHTML=`
    <th>Product</th>
    <th>Price</th>
    <th>Qty</th>
    <th>Total</th>
    <th>Wholesale</th>
  `;orderTable.appendChild(tableHeader);for(let i=0;i<orderSummary.length;i++){const{productName,price,quantity,total,isWholesale}=orderSummary[i];const tableRow=document.createElement("tr");tableRow.innerHTML=`
      <td>${productName}</td>
      <td>UGX ${price}</td>
      <td>${quantity}</td>
      <td>UGX ${total.toFixed(2)}</td>
      <td>${isWholesale?"Yes":"No"}</td>
    `;orderTable.appendChild(tableRow)}popupContent.appendChild(orderTable);const totalElement=document.createElement("h4");totalElement.innerText=`Total: UGX ${cartTotal.toFixed(2)}`;totalElement.style.fontSize="18px";totalElement.style.marginTop="10px";totalElement.style.color="#333";popupContent.appendChild(totalElement);const popupContainer=document.createElement("div");popupContainer.classList.add("popup-container");popupContainer.appendChild(popupContent);document.body.appendChild(popupContainer);const closeButton=document.createElement("button");closeButton.classList.add("close-button");closeButton.innerHTML="&times; Close";function registerPopupCloseListener(){closeButton.addEventListener("click",()=>{popupContainer.style.display="none"})}registerPopupCloseListener();window.addEventListener("popstate",function(event){registerPopupCloseListener()});popupContainer.appendChild(closeButton);const customerDetails=document.createElement("div");customerDetails.classList.add("customer-details");const paymentOptionsSection=document.createElement("div");paymentOptionsSection.classList.add("payment-options");const paymentOptionsTitle=document.createElement("h4");paymentOptionsTitle.innerText="Payment Options";paymentOptionsSection.appendChild(paymentOptionsTitle);const paymentOptionsNote=document.createElement("p");paymentOptionsNote.innerText="Click the payment option to copy the receiver details. After Placing your Order, track it in your account and use it's order ID as reason while making the payment. Thank You! ";paymentOptionsNote.classList.add("payment-options-note");paymentOptionsSection.appendChild(paymentOptionsNote);const paymentOptions=["Mobile Money"];paymentOptions.forEach(option=>{const paymentOptionContainer=document.createElement("div");paymentOptionContainer.classList.add("payment-option-container");const paymentOption=document.createElement("div");paymentOption.classList.add("payment-option");paymentOption.innerHTML=`
    <input type="radio" name="payment-option" id="${option.toLowerCase()}" value="${option.toLowerCase()}">
    <label for="${option.toLowerCase()}">${option}</label>
  `;const detailsSection=document.createElement("div");detailsSection.classList.add("details-section");const copyIcon=document.createElement("i");copyIcon.classList.add("fas","fa-copy","copy-icon");detailsSection.appendChild(copyIcon);const copyWord=document.createElement("span");copyWord.innerText="Copy";detailsSection.appendChild(copyWord);paymentOption.appendChild(detailsSection);paymentOption.addEventListener("click",()=>{const selectedOption=document.querySelector('input[name="payment-option"]:checked').value;if(selectedOption&&receiverDetails[selectedOption]){const merchantDetails=receiverDetails[selectedOption].split("\n");if(merchantDetails.length>=2){const merchantCode=merchantDetails[1].split(": ")[1];copyToClipboard(merchantCode);const message=document.createElement("div");message.className="copied-message";message.textContent="Payment Number Copied to clipboard";document.body.appendChild(message);setTimeout(()=>{message.classList.add("show")},100);setTimeout(()=>{message.classList.remove("show");setTimeout(()=>{document.body.removeChild(message)},500)},2e3)}else{console.error("Invalid receiver details format for the selected payment option.")}}else{console.error("Receiver details not found for the selected payment option.")}});paymentOptionContainer.appendChild(paymentOption);paymentOptionsSection.appendChild(paymentOptionContainer)});popupContent.appendChild(paymentOptionsSection);function copyToClipboard(text){const tempInput=document.createElement("textarea");tempInput.value=text;document.body.appendChild(tempInput);tempInput.select();document.execCommand("copy");document.body.removeChild(tempInput)}const receiverDetailsSection=document.createElement("div");receiverDetailsSection.classList.add("receiver-details");const receiverDetails={"mobile money":"Receiver: Daisy Nakitto\nMTN Number: 0774 050 825"};function updateReceiverDetails(){receiverDetailsSection.innerHTML="";const selectedOption=document.querySelector('input[name="payment-option"]:checked').value;const details=document.createElement("p");details.innerText=receiverDetails[selectedOption];receiverDetailsSection.appendChild(details)}const paymentOptionRadios=document.querySelectorAll('input[name="payment-option"]');paymentOptionRadios.forEach(radio=>{radio.addEventListener("change",updateReceiverDetails)});paymentOptionsSection.appendChild(receiverDetailsSection);const head=document.createElement("h4");head.innerText="Delivery details.";popupContent.appendChild(head);const note=document.createElement("p");note.innerText="Please note that transport and delivery costs are on the side of the customer.";note.classList.add("order-note2");popupContent.appendChild(note);const transportSelect=document.createElement("select");transportSelect.classList.add("input-field");const option1=document.createElement("option");option1.value="taxi";option1.text="Taxi";transportSelect.appendChild(option1);const option2=document.createElement("option");option2.value="boda boda";option2.text="Boda boda";transportSelect.appendChild(option2);const option3=document.createElement("option");option3.value="bus";option3.text="Bus";transportSelect.appendChild(option3);const option4=document.createElement("option");option4.value="foot";option4.text="Foot";transportSelect.appendChild(option4);const defaultOption=document.createElement("option");defaultOption.value="";defaultOption.text="Select Means of Transport";defaultOption.disabled=true;defaultOption.selected=true;transportSelect.appendChild(defaultOption);transportSelect.required=true;customerDetails.appendChild(transportSelect);popupContent.appendChild(customerDetails);const deliveryPlaceInput=document.createElement("input");deliveryPlaceInput.type="text";deliveryPlaceInput.placeholder="Delivery Place or Location";deliveryPlaceInput.classList.add("input-field");deliveryPlaceInput.required=true;customerDetails.appendChild(deliveryPlaceInput);popupContent.appendChild(customerDetails);const telephoneInput=document.createElement("input");telephoneInput.type="tel";telephoneInput.placeholder="Telephone Contact";telephoneInput.classList.add("input-field");telephoneInput.required=true;customerDetails.appendChild(telephoneInput);customerDetails.appendChild(telephoneInput);const orderButton=document.createElement("button");orderButton.innerText="Place Order";orderButton.classList.add("order-button");orderButton.style.backgroundColor="#3f51b5";orderButton.style.width="fit-content";orderButton.style.color="#fff";orderButton.style.padding="10px 20px";orderButton.style.border="none";orderButton.style.borderRadius="4px";orderButton.style.fontSize="16px";orderButton.style.marginTop="20px";popupContent.appendChild(orderButton);function showNotLoggedInMessage(){function getOrderSummary(){const orderSummary=[];const rows=orderTable.querySelectorAll("tr");rows.forEach((row,index)=>{if(index>0){const columns=row.querySelectorAll("td");const productName=columns[0].innerText;const price=parseFloat(columns[1].innerText.replace("UGX ",""));const quantity=parseInt(columns[2].innerText,10);const total=parseFloat(columns[3].innerText.replace("UGX ",""));const isWholesale=columns[4].innerText.toLowerCase()==="yes";orderSummary.push({productName:productName,price:price,quantity:quantity,total:total,isWholesale:isWholesale})}});return orderSummary}const deliveryPlace=deliveryPlaceInput.value.trim();const telephoneNumber=telephoneInput.value.trim();const meansOfTransport=transportSelect.value.trim();const selectedPaymentOptionElement=document.querySelector('input[name="payment-option"]:checked');const selectedPaymentOption=selectedPaymentOptionElement?selectedPaymentOptionElement.value:"";const orderSummary=getOrderSummary();const cartTotalElement=document.getElementById("total-price");const cartTotal=cartTotalElement?parseFloat(cartTotalElement.innerText.replace("TOTAL: UGX ","")):0;let errorMessage="";if(!deliveryPlace){errorMessage+="Delivery place is required. "}if(!telephoneNumber){errorMessage+="Telephone number is required. "}if(!meansOfTransport){errorMessage+="Means of transport is required. "}if(!selectedPaymentOption){errorMessage+="Payment option is required. "}if(orderSummary.length===0){errorMessage+="Order summary is empty. "}if(cartTotal<=0){errorMessage+="Cart total is invalid. "}if(errorMessage){alert(errorMessage)}else{const messageContainer=document.getElementById("messageContainer");const messageContent=document.getElementById("messageContent");const overlay=document.getElementById("overlay2");const cartDetails={deliveryPlace:deliveryPlace,telephoneNumber:telephoneNumber,meansOfTransport:meansOfTransport,selectedPaymentOption:selectedPaymentOption,orderSummary:orderSummary,cartTotal:cartTotal};messageContent.innerHTML=`
          <div id="companyLogo" class="company-logo">
              <img src="bibo-phone-spare-world-logo-zip-file/png/logo-color.png" alt="Company Logo">
          </div>
          <p>You are not signed in. Please sign in to access your account and shop with us. Thank you!</p>
          <button id="loginButton" class="login-button">
              <i class="fa fa-sign-in"></i> Login
          </button>
      `;localStorage.setItem("cartDetails",JSON.stringify(cartDetails));messageContainer.classList.add("fade-in");messageContainer.style.display="flex";overlay.style.display="block";const loginButton=document.getElementById("loginButton");loginButton.addEventListener("click",function(){window.location.href="login.html"})}}function removeLoaderContainer(){const loaderContainer=document.querySelector(".loader-container");if(loaderContainer){document.body.removeChild(loaderContainer)}}function showSuccessPopup(){removeLoaderContainer();const successPopup=document.createElement("div");successPopup.classList.add("success-popup");const successMessage=document.createElement("h3");const successText=document.createElement("p");successText.innerText="Thank you for shopping with us... You can always find your receipts in your account and use ORDER IDs as reasons for payment. Thank you.";successMessage.innerText="Order Successful !";const okayButton=document.createElement("button");okayButton.classList.add("okay-button");okayButton.innerText="Okay";successPopup.appendChild(okayButton);okayButton.addEventListener("click",()=>{location.reload();document.body.removeChild(successPopup)});successPopup.appendChild(successMessage);successPopup.appendChild(successText);successPopup.appendChild(okayButton);document.body.appendChild(successPopup)}function showErrorPopup(){removeLoaderContainer();const errorPopup=document.createElement("div");errorPopup.classList.add("error-popup");const errorMessage=document.createElement("h3");errorMessage.innerText="Oops..., something went wrong! Check your internet connection or else you have missing fields";const okayButton=document.createElement("button");okayButton.classList.add("okay-button");okayButton.innerText="Okay";okayButton.addEventListener("click",()=>{document.body.removeChild(errorPopup)});errorPopup.appendChild(okayButton);errorPopup.appendChild(errorMessage);errorPopup.appendChild(okayButton);document.body.appendChild(errorPopup)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");cartCountElement.innerText=count}function clearCart(){const cartItems=document.getElementsByClassName("cart-item");while(cartItems.length>0){cartItems[0].remove()}updateCartCount(0);const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX 0.00"}orderButton.addEventListener("click",async()=>{const loader=document.createElement("div");loader.classList.add("loader");popupContainer.appendChild(loader);const user=auth.currentUser;if(!user){showNotLoggedInMessage();return}const userId=user.uid;const userEmail=user.email;const deliveryPlace=deliveryPlaceInput.value;const meansOfTransport=transportSelect.value;const selectedPaymentOptionElement=document.querySelector('input[name="payment-option"]:checked');if(!selectedPaymentOptionElement){showErrorPopup("Please select a payment option");return}const selectedPaymentOption=selectedPaymentOptionElement.value;const orderSummary=[];const rows=orderTable.querySelectorAll("tr");rows.forEach((row,index)=>{if(index>0){const columns=row.querySelectorAll("td");const productName=columns[0].innerText;const price=parseFloat(columns[1].innerText.replace("UGX ",""));const quantity=parseInt(columns[2].innerText,10);const total=parseFloat(columns[3].innerText.replace("UGX ",""));const isWholesale=columns[4].innerText.toLowerCase()==="yes";orderSummary.push({productName:productName,price:price,quantity:quantity,total:total,isWholesale:isWholesale})}});const cartTotalElement=document.getElementById("total-price");const cartTotal=parseFloat(cartTotalElement.innerText.replace("TOTAL: UGX ",""));const loaderContainer=document.createElement("div");loaderContainer.classList.add("loader-container");loaderContainer.appendChild(loader);document.body.appendChild(loaderContainer);const orderRef=ref(database,"orders");const newOrderRef=push(orderRef);const telephoneNumber=telephoneInput.value;const selectedOrderType=document.querySelector('input[name="order-type"]:checked');if(!deliveryPlace||!meansOfTransport||!telephoneNumber){showErrorPopup("Please fill in all required fields and select an order type");document.body.removeChild(loaderContainer);return}function generateRandomOrderId(length){const characters="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let result="";for(let i=0;i<length;i++){const randomIndex=Math.floor(Math.random()*characters.length);result+=characters.charAt(randomIndex)}return result}const randomOrderId=generateRandomOrderId(5);const orderData={orderId:randomOrderId,orderDate:(new Date).toLocaleDateString(),orderTime:(new Date).toLocaleTimeString(),deliveryPlace:deliveryPlace,meansOfTransport:meansOfTransport,selectedPaymentOption:selectedPaymentOption,orderSummary:orderSummary,cartTotal:cartTotal,userId:userId,userEmail:userEmail,telephoneNumber:telephoneNumber};set(newOrderRef,orderData).then(()=>{const userReceiptRef=ref(database,`users/${userId}/receipts`);const newUserReceiptRef=push(userReceiptRef);const receiptData={orderId:randomOrderId,orderDate:orderData.orderDate,orderTime:orderData.orderTime,deliveryPlace:orderData.deliveryPlace,meansOfTransport:orderData.meansOfTransport,selectedPaymentOption:orderData.selectedPaymentOption,orderSummary:orderData.orderSummary,cartTotal:orderData.cartTotal,userId:userId,userEmail:user.email};set(newUserReceiptRef,receiptData).then(()=>{showSuccessPopup();clearCart()})["catch"](error=>{console.error("Error saving receipt:",error.message);showErrorPopup()})["finally"](()=>{document.body.removeChild(loaderContainer)})})["catch"](error=>{console.error("Error placing order:",error.message);showErrorPopup();document.body.removeChild(loaderContainer)});setTimeout(()=>{showSuccessPopup()},2e3)})})});document.getElementById("viewPurchaseHistoryBtn").addEventListener("click",async function(event){event.preventDefault();const viewHistoryBtn=document.getElementById("viewPurchaseHistoryBtn");const spinner=document.getElementById("spinner2");viewHistoryBtn.disabled=true;spinner.style.display="block";const user=auth.currentUser;if(!user){console.log("User not authenticated");return}const userId=user.uid;const userReceiptsRef=ref(database,`users/${userId}/receipts`);try{const userReceiptsSnapshot=await get(userReceiptsRef);if(userReceiptsSnapshot.exists()){const userReceipts=userReceiptsSnapshot.val();displayReceiptsPopup(userReceipts)}else{showNoPurchaseMessage()}}catch(error){console.error("Error fetching user receipts from Firebase:",error.message)}finally{viewHistoryBtn.disabled=false;spinner.style.display="none"}});function showNoPurchaseMessage(){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`No purchase history found!`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}function displayReceiptsPopup(userReceipts){const popupContainer=document.createElement("div");popupContainer.classList.add("popup-container");const closeButton=document.createElement("button");closeButton.innerText="Close";closeButton.classList.add("close-button");closeButton.addEventListener("click",()=>{popupContainer.style.animation="fadeOut 0.5s";setTimeout(()=>{document.body.removeChild(popupContainer)},500)});const receiptDetailsContainer=document.createElement("div");receiptDetailsContainer.classList.add("receipt-details-container");const dateFilterLabel=document.createElement("label");dateFilterLabel.innerText="Filter by Date";const dateFilterInput=document.createElement("input");dateFilterInput.type="date";dateFilterInput.placeholder="Filter by Date";dateFilterInput.addEventListener("input",handleDateFilter);const clearDateButton=document.createElement("button");clearDateButton.innerText="Clear";clearDateButton.classList.add("clear-button");clearDateButton.addEventListener("click",clearDateFilter);const orderIdSearchLabel=document.createElement("label");orderIdSearchLabel.innerText="Search by Order ID";const orderIdSearchInput=document.createElement("input");orderIdSearchInput.type="text";orderIdSearchInput.placeholder="Search by Order ID";orderIdSearchInput.addEventListener("input",handleOrderIdSearch);const filterContainer=document.createElement("div");filterContainer.classList.add("filter-container");filterContainer.appendChild(orderIdSearchLabel);filterContainer.appendChild(orderIdSearchInput);filterContainer.appendChild(dateFilterLabel);filterContainer.appendChild(dateFilterInput);filterContainer.appendChild(clearDateButton);popupContainer.appendChild(filterContainer);popupContainer.style.animation="fadeIn 0.5s";dateFilterInput.addEventListener("input",handleDateFilter);orderIdSearchInput.addEventListener("input",handleOrderIdSearch);function clearDateFilter(){dateFilterInput.value="";handleDateFilter({target:{value:""}})}function handleDateFilter(event){const selectedDate=event.target.value;document.querySelectorAll(".receipt-container").forEach(receiptContainer=>{receiptContainer.style.display="none"});const receiptDetailsContainer=document.querySelector(".receipt-details-container");let noOrdersMessageContainer=receiptDetailsContainer.querySelector(".no-orders-message-container");if(!noOrdersMessageContainer){noOrdersMessageContainer=document.createElement("div");noOrdersMessageContainer.classList.add("no-orders-message-container");receiptDetailsContainer.appendChild(noOrdersMessageContainer);const noOrdersImage=document.createElement("img");noOrdersImage.src="img/nothing found.png";noOrdersImage.alt="No Orders Image";noOrdersImage.classList.add("no-orders-image");noOrdersMessageContainer.appendChild(noOrdersImage);const noOrdersMessage=document.createElement("p");noOrdersMessage.classList.add("no-orders-message");noOrdersMessageContainer.appendChild(noOrdersMessage)}noOrdersMessageContainer.style.display="none";noOrdersMessageContainer.querySelector(".no-orders-message").textContent="";let ordersFound=false;document.querySelectorAll(".receipt-container").forEach(receiptContainer=>{const orderDateElement=receiptContainer.querySelector(".receipt-info:nth-child(2)");const orderDate=orderDateElement.textContent.split(": ")[1];const formattedOrderDate=new Date(orderDate);if(!isNaN(formattedOrderDate.getTime())){const formattedSelectedDate=formattedOrderDate.toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric"});const selectedDateObj=new Date(selectedDate);if(selectedDate&&formattedOrderDate.toISOString().split("T")[0]!==selectedDateObj.toISOString().split("T")[0]){receiptContainer.style.display="none"}else{receiptContainer.style.display="block";ordersFound=true}}});noOrdersMessageContainer.style.display=ordersFound?"none":"block";if(!ordersFound){noOrdersMessageContainer.querySelector(".no-orders-message").textContent="No orders found on this date."}dateFilterInput.addEventListener("input",handleDateFilter);orderIdSearchInput.addEventListener("input",handleOrderIdSearch)}function handleOrderIdSearch(event){const searchText=event.target.value.toLowerCase();document.querySelectorAll(".receipt-container").forEach(receiptContainer=>{receiptContainer.style.display="none"});const receiptDetailsContainer=document.querySelector(".receipt-details-container");let searchResultsContainer=receiptDetailsContainer.querySelector(".search-results-container");if(!searchResultsContainer){searchResultsContainer=document.createElement("div");searchResultsContainer.classList.add("search-results-container");receiptDetailsContainer.appendChild(searchResultsContainer);const noOrdersImage=document.createElement("img");noOrdersImage.src="img/nothing found.png";noOrdersImage.alt="No Orders Image";noOrdersImage.classList.add("no-orders-image");searchResultsContainer.appendChild(noOrdersImage);const noOrdersMessage=document.createElement("p");noOrdersMessage.classList.add("no-orders-message");searchResultsContainer.appendChild(noOrdersMessage)}searchResultsContainer.style.display="none";const noOrdersMessageElement=searchResultsContainer.querySelector(".no-orders-message");if(noOrdersMessageElement){noOrdersMessageElement.textContent="";let ordersFound=false;document.querySelectorAll(".receipt-container").forEach(receiptContainer=>{const orderId=receiptContainer.querySelector(".receipt-info:first-child").textContent;if(searchText&&!orderId.toLowerCase().includes(`${searchText}`)){receiptContainer.style.display="none"}else{receiptContainer.style.display="block";ordersFound=true}});searchResultsContainer.style.display=ordersFound?"none":"block";if(!ordersFound){noOrdersMessageElement.textContent="No orders found for the specified order ID."}}dateFilterInput.addEventListener("input",handleDateFilter);orderIdSearchInput.addEventListener("input",handleOrderIdSearch)}const sortedReceiptIds=Object.keys(userReceipts).sort((a,b)=>userReceipts[b].orderId-userReceipts[a].orderId);sortedReceiptIds.reverse();for(const receiptId of sortedReceiptIds){const receipt=userReceipts[receiptId];const receiptContainer=document.createElement("div");receiptContainer.classList.add("receipt-container");const receiptDetails=`
    <p class="receipt-info"><span>Order ID:  </span>${receipt.orderId}</p>
    <p class="receipt-info"><span>Order Date:  </span>${receipt.orderDate}</p>
    <p class="receipt-info"><span>Delivery Place: </span>${receipt.deliveryPlace}</p>
    <p class="receipt-info"><span>Means of Transport:  </span>${receipt.meansOfTransport}</p>
    <p class="receipt-info"><span>Payment Option:  </span>${receipt.selectedPaymentOption}</p>
    <p class="receipt-info"><span>Order Time:  </span>${receipt.orderTime}</p>
    <!-- Replace the existing order summary element with this table -->
    <table class="order-summary-table">
      <caption>Order Summary</caption>
      <thead>
        <tr>
          <th>Pdt</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Total</th>
          <th>WholeSale</th>
        </tr>
      </thead>
      <tbody>
        <!-- Iterate through each item in the order summary -->
        ${receipt.orderSummary.map(item=>`
          <tr>
            <td>${item.productName}</td>
            <td>${item.quantity}</td>
            <td>UGX ${item.price.toFixed(2)}</td>
            <td>UGX ${item.total.toFixed(2)}</td>
            <td>${item.isWholesale}</td>
          </tr>
        `).join("")}
      </tbody>
    </table>
    <p class="receipt-info">Cart Total: UGX ${receipt.cartTotal.toFixed(2)}</p>
  `;receiptContainer.innerHTML=receiptDetails;receiptDetailsContainer.appendChild(receiptContainer)}popupContainer.appendChild(closeButton);popupContainer.appendChild(filterContainer);popupContainer.appendChild(receiptDetailsContainer);document.body.appendChild(popupContainer);popupContainer.style.animation="fadeIn 0.5s"}const newScreensRef=ref(database,"products/newScreens");const gradeBScreensRef=ref(database,"products/gradeBScreens");const electronicsRef=ref(database,"products/electronics");const touchesRef=ref(database,"products/touches");const accessoriesRef=ref(database,"products/accessories");const portsRef=ref(database,"products/Ports");const fibresRef=ref(database,"products/Fibres");const buttonsRef=ref(database,"products/Buttons");const fingerPrintsRef=ref(database,"products/Finger-Prints");const cameraGlassRef=ref(database,"products/Camera-Glasses");const backCoversRef=ref(database,"products/Back-Covers");const chesisRef=ref(database,"products/Chesis");const glassesRef=ref(database,"products/Glasses");const productRefs=[newScreensRef,gradeBScreensRef,electronicsRef,touchesRef,accessoriesRef,portsRef,fibresRef,buttonsRef,fingerPrintsRef,cameraGlassRef,backCoversRef,chesisRef,glassesRef];const observerOptions={root:null,rootMargin:"0px",threshold:.5};const intersectionCallback=(entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){const productRef=entry.target.dataset.productRef;retrieveProducts(productRef);observer.unobserve(entry.target)}})};const productObserver=new IntersectionObserver(intersectionCallback,observerOptions);function observeProduct(productRef){const productContainer=document.createElement("div");productContainer.dataset.productRef=productRef;document.getElementById("products-list").appendChild(productContainer);productObserver.observe(productContainer)}const searchBtn=document.getElementById("search-btn");let isSearching=false;searchBtn.addEventListener("click",function(event){event.preventDefault();if(isSearching){searchProducts()}else{if(shouldShowRefreshIcon()){appendRefreshIcon();searchProducts();isSearching=true}}function shouldShowRefreshIcon(){const searchBar=document.getElementById("search-bar");return searchBar.value.trim()!==""}function appendRefreshIcon(){if(!shouldShowRefreshIcon()){return}const refreshIcon=document.createElement("i");refreshIcon.classList.add("fa","fa-refresh","refresh-icon");const searchBar=document.getElementById("search-bar");searchBar.parentNode.insertBefore(refreshIcon,searchBar.nextSibling);refreshIcon.addEventListener("click",function(){clearSearchBar();searchProducts()});searchBtn.style.background="orange"}function clearSearchBar(){const searchBar=document.getElementById("search-bar");searchBar.value="";isSearching=false;revertSearchButton()}function revertSearchButton(){const searchBar=document.getElementById("search-bar");const icon=searchBar.nextSibling;if(icon&&icon.classList.contains("refresh-icon")){searchBar.parentNode.removeChild(icon)}searchBtn.style.background="#008abf"}});const searchBar=document.getElementById("search-bar");const suggestionsContainer=document.getElementById("suggestions-container");const overlay=document.getElementById("overlay");const suggestionsTitle=document.createElement("div");suggestionsTitle.classList.add("suggestions-title");suggestionsTitle.textContent="Suggestions";suggestionsContainer.appendChild(suggestionsTitle);let lastQuery="";let suggestionsProcessed=true;function fetchSuggestions(query,retryCount=1){return new Promise((resolve,reject)=>{const firebaseNodes=[newScreensRef,gradeBScreensRef,electronicsRef,touchesRef,accessoriesRef,portsRef,fibresRef,buttonsRef,fingerPrintsRef,cameraGlassRef,backCoversRef,chesisRef,glassesRef];const promises=[];let matchingProductsFound=false;const containsAllWords=(str,words)=>{return words.every(word=>str.includes(word))};firebaseNodes.forEach(nodeRef=>{const promise=get(nodeRef).then(snapshot=>{const data=snapshot.val();for(let productId in data){const product=data[productId];const name=product.name.toLowerCase();const description=product.description.toLowerCase();if(containsAllWords(name,query.toLowerCase().split(" "))||containsAllWords(name,query.replace(/[^a-zA-Z0-9\s]/g,"").toLowerCase().split(" "))||name.includes(query.toLowerCase())||description.includes(query.toLowerCase())){matchingProductsFound=true;const suggestionItem=document.createElement("div");suggestionItem.classList.add("suggestion-item");const searchIcon=document.createElement("i");searchIcon.classList.add("fa","fa-search","search-icon");suggestionItem.appendChild(searchIcon);const suggestionText=document.createTextNode(name);suggestionItem.appendChild(suggestionText);suggestionItem.addEventListener("click",function(){searchBar.value=name;suggestionsContainer.style.display="none";overlay.style.display="none";searchProducts(name)});suggestionsContainer.appendChild(suggestionItem)}}});promises.push(promise)});Promise.all(promises).then(()=>{suggestionsProcessed=true;matchingProductsFound?resolve():reject()})})}function initializeSearch(){searchBar.addEventListener("input",function(){while(suggestionsContainer.children.length>3){suggestionsContainer.removeChild(suggestionsContainer.lastChild)}const query=searchBar.value.trim().toLowerCase();if(!query){suggestionsContainer.style.display="none";overlay.style.display="none";return}lastQuery=query;if(suggestionsProcessed){suggestionsProcessed=false;fetchSuggestions(query).then(()=>{suggestionsContainer.style.display="block";overlay.style.display="block"})["catch"](()=>{const noResultsMessage=document.createElement("div");noResultsMessage.classList.add("no-results-message");noResultsMessage.textContent="No Matching products found!";suggestionsContainer.appendChild(noResultsMessage);suggestionsContainer.style.display="block";overlay.style.display="block"})}});document.addEventListener("click",function(event){const searchBar=document.getElementById("search-bar");const suggestionsContainer=document.getElementById("suggestions-container");const overlay=document.getElementById("overlay");if(event.target!==searchBar&&!searchBar.contains(event.target)&&event.target!==suggestionsContainer&&!suggestionsContainer.contains(event.target)){suggestionsContainer.style.display="none";overlay.style.display="none"}})}initializeSearch();function searchProducts(searchTerm){const query=document.getElementById("search-bar").value.toLowerCase();const loader=document.getElementById("loader");loader.style.display="block";document.getElementById("products-list").innerHTML="";const firebaseNodes=[newScreensRef,gradeBScreensRef,electronicsRef,touchesRef,accessoriesRef,portsRef,fibresRef,buttonsRef,fingerPrintsRef,cameraGlassRef,backCoversRef,chesisRef,glassesRef];const promises=[];firebaseNodes.forEach(nodeRef=>{const promise=get(nodeRef).then(snapshot=>{const data=snapshot.val();const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const name=product.name.toLowerCase();const description=product.description.toLowerCase();const queryLower=query.toLowerCase();const nameSimilarity=calculateSimilarity({innerText:name},queryLower);const descriptionSimilarity=calculateSimilarity({innerText:description},queryLower);if(!queryLower||nameSimilarity>.6||descriptionSimilarity>.6||name.includes(queryLower)||description.includes(queryLower)){const card=document.createElement("div");card.classList.add("card1");const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const subcategories=["accessories","Ports","touches","newScreens","gradeBScreens","electronics"];for(const subcategory of subcategories){const productsRef=ref(database,`products/${subcategory}`);const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}productsList.appendChild(card)}}});promises.push(promise)});Promise.all(promises).then(()=>{const products=Array.from(document.querySelectorAll(".card1"));products.sort((a,b)=>{const aSimilarity=calculateSimilarity(a,query);const bSimilarity=calculateSimilarity(b,query);return bSimilarity-aSimilarity});document.getElementById("products-list").innerHTML="";const productsList=document.getElementById("products-list");if(products.length===0){const noResultsContainer=document.createElement("div");noResultsContainer.classList.add("no-results-container");const noResultsImage=document.createElement("img");noResultsImage.src="img/nothing found.png";noResultsImage.alt="No Results Image";noResultsContainer.appendChild(noResultsImage);const noResultsMessage=document.createElement("p");noResultsMessage.innerText="Oops...No relevant products found. If you cant find your desired product, please contact us to add it. Thank you!";noResultsMessage.classList.add("no-results-message");noResultsContainer.appendChild(noResultsMessage);productsList.appendChild(noResultsContainer)}else{products.forEach(product=>productsList.appendChild(product))}loader.style.display="none"})}function similarity(str1,str2){const maxLength=Math.max(str1.length,str2.length);const distance=levenshteinDistance(str1,str2);return 1-distance/maxLength}function levenshteinDistance(str1,str2){const m=str1.length;const n=str2.length;const dp=Array.from({length:m+1},()=>Array(n+1).fill(0));for(let i=0;i<=m;i++){for(let j=0;j<=n;j++){if(i===0){dp[i][j]=j}else if(j===0){dp[i][j]=i}else if(str1[i-1]===str2[j-1]){dp[i][j]=dp[i-1][j-1]}else{dp[i][j]=1+Math.min(dp[i-1][j],dp[i][j-1],dp[i-1][j-1])}}}return dp[m][n]}function calculateSimilarity(productCard,query){const productText=productCard.innerText.toLowerCase();const queryWords=query.toLowerCase().split(" ");const permutations=generatePermutations(queryWords);let maxSimilarity=0;for(const perm of permutations){const permString=perm.join(" ");const currentSimilarity=similarity(productText,permString);maxSimilarity=Math.max(maxSimilarity,currentSimilarity)}return maxSimilarity}function generatePermutations(arr){if(arr.length<=1){return[arr]}const result=[];for(let i=0;i<arr.length;i++){const rest=[...arr.slice(0,i),...arr.slice(i+1)];const permutations=generatePermutations(rest);for(const perm of permutations){result.push([arr[i],...perm])}}return result}document.querySelector("#cameraGlass-link").addEventListener("click",()=>{document.getElementById("products-list").innerHTML="";const loader=document.getElementById("loader");loader.style.display="block";get(cameraGlassRef).then(snapshot=>{const data=snapshot.val();const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const badge=document.createElement("div");badge.classList.add("used-badge2");badge.innerText="Brand New";card.appendChild(badge);const guaranteeText=document.createElement("div");guaranteeText.innerHTML="<i class='fa fa-shield'></i>Good, Tested and Trusted Quality";guaranteeText.classList.add("guarantee-text");card.appendChild(guaranteeText);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/Camera-Glasses");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}productsList.appendChild(card);loader.style.display="none"}})});document.querySelector("#brand-new-link").addEventListener("click",()=>{document.getElementById("products-list").innerHTML="";const loader=document.getElementById("loader");loader.style.display="block";get(newScreensRef).then(snapshot=>{const data=snapshot.val();const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const badge=document.createElement("div");badge.classList.add("used-badge2");badge.innerText="Brand New";card.appendChild(badge);const guaranteeText=document.createElement("div");guaranteeText.innerHTML="<i class='fa fa-shield'></i>Good, Tested and Trusted Quality";guaranteeText.classList.add("guarantee-text");card.appendChild(guaranteeText);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/newScreens");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}productsList.appendChild(card);loader.style.display="none"}})});document.querySelector("#uk-used-link").addEventListener("click",()=>{document.getElementById("products-list").innerHTML="";const loader=document.getElementById("loader");loader.style.display="block";get(gradeBScreensRef).then(snapshot=>{const data=snapshot.val();const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const badge=document.createElement("div");badge.classList.add("used-badge");badge.innerText="Grade B";card.appendChild(badge);const guaranteeText=document.createElement("div");guaranteeText.innerHTML="<i class='fa fa-shield'></i>No Guarantee for Grade B";guaranteeText.classList.add("guarantee-text");card.appendChild(guaranteeText);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/gradeBScreens");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}productsList.appendChild(card);loader.style.display="none"}})});document.querySelector("#newScreens-link").addEventListener("click",()=>{document.getElementById("products-list").innerHTML="";const loader=document.getElementById("loader");loader.style.display="block";get(newScreensRef).then(snapshot=>{const data=snapshot.val();const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const badge=document.createElement("div");badge.classList.add("used-badge2");badge.innerText="Brand New";card.appendChild(badge);const guaranteeText=document.createElement("div");guaranteeText.innerHTML="<i class='fa fa-shield'></i>Good, Tested and Trusted Quality Screens";guaranteeText.classList.add("guarantee-text");card.appendChild(guaranteeText);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/newScreens");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}productsList.appendChild(card);loader.style.display="none"}})});get(gradeBScreensRef).then(snapshot=>{const data=snapshot.val();const loader=document.getElementById("loader");loader.style.display="block";const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const badge=document.createElement("div");badge.classList.add("used-badge");badge.innerText="Grade B ";card.appendChild(badge);const guaranteeText=document.createElement("div");guaranteeText.innerHTML="<i class='fa fa-shield'></i> No Guarantee for Grede B";guaranteeText.classList.add("guarantee-text");card.appendChild(guaranteeText);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/gradeBScreens");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}productsList.appendChild(card);loader.style.display="none"}});document.querySelector("#touches-link").addEventListener("click",()=>{document.getElementById("products-list").innerHTML="";const loader=document.getElementById("loader");loader.style.display="block";get(touchesRef).then(snapshot=>{const data=snapshot.val();const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const badge=document.createElement("div");badge.classList.add("used-badge2");badge.innerText="Brand New";card.appendChild(badge);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/touches");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}productsList.appendChild(card);loader.style.display="none"}})});document.querySelector("#glasses-link").addEventListener("click",()=>{document.getElementById("products-list").innerHTML="";const loader=document.getElementById("loader");loader.style.display="block";get(glassesRef).then(snapshot=>{const data=snapshot.val();const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const badge=document.createElement("div");badge.classList.add("used-badge2");badge.innerText="Brand New";card.appendChild(badge);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/Glasses");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}productsList.appendChild(card);loader.style.display="none"}})});document.querySelector("#backcovers-link").addEventListener("click",()=>{document.getElementById("products-list").innerHTML="";const loader=document.getElementById("loader");loader.style.display="block";get(backCoversRef).then(snapshot=>{const data=snapshot.val();const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const badge=document.createElement("div");badge.classList.add("used-badge2");badge.innerText="Brand New";card.appendChild(badge);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/Back-Covers");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}productsList.appendChild(card);loader.style.display="none"}})});document.querySelector("#chesis-link").addEventListener("click",()=>{document.getElementById("products-list").innerHTML="";const loader=document.getElementById("loader");loader.style.display="block";get(chesisRef).then(snapshot=>{const data=snapshot.val();const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const badge=document.createElement("div");badge.classList.add("used-badge2");badge.innerText="Brand New";card.appendChild(badge);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/Chesis");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}productsList.appendChild(card);loader.style.display="none"}})});document.querySelector("#fingerPrint-link").addEventListener("click",()=>{document.getElementById("products-list").innerHTML="";const loader=document.getElementById("loader");loader.style.display="block";get(fingerPrintsRef).then(snapshot=>{const data=snapshot.val();const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const badge=document.createElement("div");badge.classList.add("used-badge2");badge.innerText="Brand New";card.appendChild(badge);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/Finger-Prints");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}productsList.appendChild(card);loader.style.display="none"}})});document.querySelector("#buttons-link").addEventListener("click",()=>{document.getElementById("products-list").innerHTML="";const loader=document.getElementById("loader");loader.style.display="block";get(buttonsRef).then(snapshot=>{const data=snapshot.val();const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const badge=document.createElement("div");badge.classList.add("used-badge2");badge.innerText="Brand New";card.appendChild(badge);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/Buttons");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}productsList.appendChild(card);loader.style.display="none"}})});document.querySelector("#fibres-link").addEventListener("click",()=>{document.getElementById("products-list").innerHTML="";const loader=document.getElementById("loader");loader.style.display="block";get(fibresRef).then(snapshot=>{const data=snapshot.val();const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const badge=document.createElement("div");badge.classList.add("used-badge2");badge.innerText="Brand New";card.appendChild(badge);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/Fibres");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}productsList.appendChild(card);loader.style.display="none"}})});document.querySelector("#electronics-link").addEventListener("click",()=>{document.getElementById("products-list").innerHTML="";const loader=document.getElementById("loader");loader.style.display="block";get(electronicsRef).then(snapshot=>{const data=snapshot.val();const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const badge=document.createElement("div");badge.classList.add("used-badge2");badge.innerText="Brand New";card.appendChild(badge);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/electronics");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}productsList.appendChild(card);loader.style.display="none"}})});document.querySelector("#accessories-link").addEventListener("click",()=>{document.getElementById("products-list").innerHTML="";const loader=document.getElementById("loader");loader.style.display="block";get(accessoriesRef).then(snapshot=>{const data=snapshot.val();const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const badge=document.createElement("div");badge.classList.add("used-badge2");badge.innerText="Brand New";card.appendChild(badge);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/accessories");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}productsList.appendChild(card);loader.style.display="none"}})});document.querySelector("#ports-link").addEventListener("click",()=>{document.getElementById("products-list").innerHTML="";const loader=document.getElementById("loader");loader.style.display="block";get(portsRef).then(snapshot=>{const data=snapshot.val();const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const badge=document.createElement("div");badge.classList.add("used-badge2");badge.innerText="Brand New";card.appendChild(badge);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/Ports");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}productsList.appendChild(card);loader.style.display="none"}})});const loaderContainer=document.querySelector(".loader-container");const productsList=document.getElementById("products-list");const modal=document.querySelector(".modal");const modalImg=document.getElementById("modalImg");const closeBtn=document.querySelector(".close");function loadNewScreenCards(data){const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const newScreenCard=document.createElement("div");newScreenCard.classList.add("card1");const usedBadge=document.createElement("div");usedBadge.classList.add("used-badge2");usedBadge.innerText="Brand New";newScreenCard.appendChild(usedBadge);const guaranteeText=document.createElement("div");guaranteeText.innerHTML="<i class='fa fa-shield'></i>Good, Tested and Trusted Quality";guaranteeText.classList.add("guarantee-text");newScreenCard.appendChild(guaranteeText);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const modal=document.querySelector(".modal");const closeBtn=document.querySelector(".close");closeBtn.addEventListener("click",()=>{modal.style.display="none"});const title=document.createElement("h2");title.innerText=product.name;newScreenCard.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}newScreenCard.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;newScreenCard.appendChild(ratingCount);const desc=document.createElement("p");desc.innerText=product.description;newScreenCard.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;newScreenCard.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");newScreenCard.appendChild(wholesalePrice);function openModal(img){document.getElementById("modalImg").src=img.src;document.querySelector(".modal").style.display="block"}document.querySelector(".close").addEventListener("click",function(){document.querySelector(".modal").style.display="none"});const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/newScreens");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";addToCart(product);updateCartTotal()});newScreenCard.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}if(isNewScreenElementInViewport(newScreenCard)){productsList.appendChild(newScreenCard)}}loader.style.display="none"}function isNewScreenElementInViewport(element){const rect=element.getBoundingClientRect();return rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)}function handleNewScreenScroll(){const productsList=document.getElementById("products-list");const newScreenCards=document.querySelectorAll(".card1");newScreenCards.forEach(newScreenCard=>{if(isNewScreenElementInViewport(newScreenCard)&&!productsList.contains(newScreenCard)){productsList.appendChild(newScreenCard)}})}window.addEventListener("scroll",handleNewScreenScroll);function loadNewScreenCardsWithRetriesAndBackoff(retries=5,initialDelay=3e3,maxDelay=16e3){function retryLoad(delay){setTimeout(()=>{get(newScreensRef).then(snapshot=>{const data=snapshot.val();if(data){loadNewScreenCards(data)}else{const nextDelay=Math.min(delay*2,maxDelay);retryLoad(nextDelay)}})["catch"](()=>{const nextDelay=Math.min(delay*2,maxDelay);retryLoad(nextDelay)})},delay)}retryLoad(initialDelay)}loadNewScreenCardsWithRetriesAndBackoff();function loadGradeBScreenCards(data){const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const gradeBScreenCard=document.createElement("div");gradeBScreenCard.classList.add("card1");const usedBadge=document.createElement("div");usedBadge.classList.add("used-badge");usedBadge.innerText="Grade B ";gradeBScreenCard.appendChild(usedBadge);const guaranteeText=document.createElement("div");guaranteeText.innerHTML="<i class='fa fa-shield'></i>No Guarantee for Grade B";guaranteeText.classList.add("guarantee-text");gradeBScreenCard.appendChild(guaranteeText);const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const modal=document.querySelector(".modal");const closeBtn=document.querySelector(".close");closeBtn.addEventListener("click",()=>{modal.style.display="none"});const title=document.createElement("h2");title.innerText=product.name;gradeBScreenCard.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}gradeBScreenCard.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;gradeBScreenCard.appendChild(ratingCount);const desc=document.createElement("p");desc.innerText=product.description;gradeBScreenCard.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;gradeBScreenCard.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");gradeBScreenCard.appendChild(wholesalePrice);function openModal(img){document.getElementById("modalImg").src=img.src;document.querySelector(".modal").style.display="block"}document.querySelector(".close").addEventListener("click",function(){document.querySelector(".modal").style.display="none"});const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/gradeBScreens");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});gradeBScreenCard.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}if(isGradeBScreenElementInViewport(gradeBScreenCard)){productsList.appendChild(gradeBScreenCard)}}loader.style.display="none"}function isGradeBScreenElementInViewport(element){const rect=element.getBoundingClientRect();return rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)}function handleGradeBScreenScroll(){const productsList=document.getElementById("products-list");const gradeBScreenCards=document.querySelectorAll(".card1");gradeBScreenCards.forEach(gradeBScreenCard=>{if(isGradeBScreenElementInViewport(gradeBScreenCard)&&!productsList.contains(gradeBScreenCard)){productsList.appendChild(gradeBScreenCard)}})}window.addEventListener("scroll",handleGradeBScreenScroll);function loadGradeBScreenCardsWithRetriesAndBackoff(retries=5,initialDelay=3e3,maxDelay=16e3){function retryLoad(delay){setTimeout(()=>{get(gradeBScreensRef).then(snapshot=>{const data=snapshot.val();if(data){loadGradeBScreenCards(data)}else{const nextDelay=Math.min(delay*2,maxDelay);retryLoad(nextDelay)}})["catch"](()=>{const nextDelay=Math.min(delay*2,maxDelay);retryLoad(nextDelay)})},delay)}retryLoad(initialDelay)}loadGradeBScreenCardsWithRetriesAndBackoff();function loadPortCards(data){const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const portCard=document.createElement("div");portCard.classList.add("card1");const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const modal=document.querySelector(".modal");const closeBtn=document.querySelector(".close");closeBtn.addEventListener("click",()=>{modal.style.display="none"});const title=document.createElement("h2");title.innerText=product.name;portCard.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}portCard.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;portCard.appendChild(ratingCount);const desc=document.createElement("p");desc.innerText=product.description;portCard.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;portCard.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");portCard.appendChild(wholesalePrice);function openModal(img){document.getElementById("modalImg").src=img.src;document.querySelector(".modal").style.display="block"}document.querySelector(".close").addEventListener("click",function(){document.querySelector(".modal").style.display="none"});const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/Ports");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});portCard.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}if(isPortElementInViewport(portCard)){productsList.appendChild(portCard)}}loader.style.display="none"}function isPortElementInViewport(element){const rect=element.getBoundingClientRect();return rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)}function handlePortScroll(){const productsList=document.getElementById("products-list");const portCards=document.querySelectorAll(".card1");portCards.forEach(portCard=>{if(isPortElementInViewport(portCard)&&!productsList.contains(portCard)){productsList.appendChild(portCard)}})}window.addEventListener("scroll",handlePortScroll);function loadPortCardsWithRetriesAndBackoff(retries=5,initialDelay=3e3,maxDelay=16e3){function retryLoad(delay){setTimeout(()=>{get(portsRef).then(snapshot=>{const data=snapshot.val();if(data){loadPortCards(data)}else{const nextDelay=Math.min(delay*2,maxDelay);retryLoad(nextDelay)}})["catch"](()=>{const nextDelay=Math.min(delay*2,maxDelay);retryLoad(nextDelay)})},delay)}retryLoad(initialDelay)}loadPortCardsWithRetriesAndBackoff();function loadTouchesCards(data){const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const modal=document.querySelector(".modal");const closeBtn=document.querySelector(".close");closeBtn.addEventListener("click",()=>{modal.style.display="none"});const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);function openModal(img){document.getElementById("modalImg").src=img.src;document.querySelector(".modal").style.display="block"}document.querySelector(".close").addEventListener("click",function(){document.querySelector(".modal").style.display="none"});const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/touches");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}if(isInViewportTouches(card)){productsList.appendChild(card)}}loader.style.display="none"}function isInViewportTouches(element){const rect=element.getBoundingClientRect();return rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)}function handleScrollTouches(){const productsList=document.getElementById("products-list");const cards=document.querySelectorAll(".card1");cards.forEach(card=>{if(isInViewportTouches(card)&&!productsList.contains(card)){productsList.appendChild(card)}})}window.addEventListener("scroll",handleScrollTouches);function loadTouchesCardsWithRetriesAndBackoff(retries=5,initialDelay=3e3,maxDelay=16e3){function retryLoad(delay){setTimeout(()=>{get(touchesRef).then(snapshot=>{const data=snapshot.val();if(data){loadTouchesCards(data)}else{const nextDelay=Math.min(delay*2,maxDelay);retryLoad(nextDelay)}})["catch"](()=>{const nextDelay=Math.min(delay*2,maxDelay);retryLoad(nextDelay)})},delay)}retryLoad(initialDelay)}loadTouchesCardsWithRetriesAndBackoff();function isInViewport(element){const rect=element.getBoundingClientRect();return rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)}function loadCards(data){const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const modal=document.querySelector(".modal");const closeBtn=document.querySelector(".close");closeBtn.addEventListener("click",()=>{modal.style.display="none"});const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);function openModal(img){document.getElementById("modalImg").src=img.src;document.querySelector(".modal").style.display="block"}document.querySelector(".close").addEventListener("click",function(){document.querySelector(".modal").style.display="none"});const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/accessories");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");const cart=document.getElementById("cart-container");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}if(isInViewport(card)){productsList.appendChild(card)}}loader.style.display="none"}function handleScroll(){const productsList=document.getElementById("products-list");const cards=document.querySelectorAll(".card1");cards.forEach(card=>{if(isInViewport(card)&&!productsList.contains(card)){productsList.appendChild(card)}})}window.addEventListener("scroll",handleScroll);function loadCardsWithRetriesAndBackoff(dataRef,loadFunction,retries=5,initialDelay=3e3,maxDelay=16e3){function retryLoad(delay){setTimeout(()=>{get(dataRef).then(snapshot=>{const data=snapshot.val();if(data){loadFunction(data)}else{const nextDelay=Math.min(delay*2,maxDelay);retryLoad(nextDelay)}})["catch"](()=>{const nextDelay=Math.min(delay*2,maxDelay);retryLoad(nextDelay)})},delay)}retryLoad(initialDelay)}loadCardsWithRetriesAndBackoff(accessoriesRef,loadCards);function loadCardsNew(data){const productsList=document.getElementById("products-list");for(let i in data){const product=data[i];const card=document.createElement("div");card.classList.add("card1");const img=document.createElement("img");img.src=product.image;img.alt=product.name;img.classList.add("product-img");const loader2=document.createElement("div");loader2.classList.add("loader2");loader2.innerHTML='<i class="fas fa-spinner fa-spin"></i>';card.appendChild(loader2);img.addEventListener("load",()=>{loader2.style.display="none"});img.addEventListener("click",()=>{const modal=document.querySelector(".modal");const modalImg=document.querySelector("#modalImg");modal.style.display="block";modalImg.src=img.src});card.appendChild(img);img.addEventListener("error",()=>{loader2.style.display="none";img.src="img/no photo.jpg";img.alt="Image Load Error"});card.appendChild(img);const modal=document.querySelector(".modal");const closeBtn=document.querySelector(".close");closeBtn.addEventListener("click",()=>{modal.style.display="none"});const title=document.createElement("h2");title.innerText=product.name;card.appendChild(title);const stars=document.createElement("div");stars.classList.add("stars");for(let j=0;j<5;j++){const star=document.createElement("span");star.classList.add("star");star.innerHTML="&#9733;";stars.appendChild(star)}card.appendChild(stars);const ratingCount=document.createElement("div");ratingCount.classList.add("rating-count");const randomRating=Math.floor(Math.random()*100001);const formattedRating=randomRating>1e3?(randomRating/1e3).toFixed(1)+"k":randomRating;ratingCount.innerText=`(${formattedRating}) 5 star ratings`;card.appendChild(ratingCount);const maxDescriptionLength=70;const desc=document.createElement("p");const originalDescription=product.description;if(originalDescription.length>maxDescriptionLength){const truncatedDescription=originalDescription.substring(0,maxDescriptionLength);desc.innerText=truncatedDescription+"...";desc.title=originalDescription}else{desc.innerText=originalDescription}card.appendChild(desc);const price=document.createElement("h4");const formattedPrice=parseFloat(product.price).toLocaleString("en-US");price.innerText=`UGX ${formattedPrice}`;card.appendChild(price);const wholesalePrice=document.createElement("h6");const formattedWholesalePrice=parseFloat(product.wholesalePrice).toLocaleString("en-US");wholesalePrice.innerHTML=` Wholesale UGX:<span class="value"> ${formattedWholesalePrice}</span>`;wholesalePrice.classList.add("wholesale-price");card.appendChild(wholesalePrice);function openModal(img){document.getElementById("modalImg").src=img.src;document.querySelector(".modal").style.display="block"}document.querySelector(".close").addEventListener("click",function(){document.querySelector(".modal").style.display="none"});const addToCartBtn=document.createElement("button");addToCartBtn.innerText="Add to Cart";const icon=document.createElement("i");icon.classList.add("fas","fa-shopping-cart");addToCartBtn.prepend(icon);let productPrice;const productTotals={};let total=0;function addToCart(product){const cartItemsContainer=document.getElementById("cart-items");const toggleContainer=document.createElement("div");toggleContainer.classList.add("toggle-container");const toggleTitle=document.createElement("p");toggleTitle.innerText="Wholesale";toggleContainer.appendChild(toggleTitle);const toggleSwitch=document.createElement("input");toggleSwitch.type="checkbox";toggleSwitch.classList.add("toggle-switch");const loadingSpinner=document.createElement("div");loadingSpinner.classList.add("loading-spinner");toggleContainer.appendChild(toggleSwitch);toggleContainer.appendChild(loadingSpinner);function handleWholesaleToggleChange(){const currentQuantity=parseInt(quantityInput.value);if(currentQuantity<4&&toggleSwitch.checked){alert("The number of pieces should be more than 3 to enable wholesale.");toggleSwitch.checked=false}else{loadingSpinner.style.display="inline-block";fetchWholesalePriceFromFirebase(product.name).then(wholesalePrice=>{loadingSpinner.style.display="none";updatePriceBasedOnToggle(product,toggleSwitch.checked,wholesalePrice)})["catch"](error=>{console.error("Error fetching wholesale price:",error)})}}toggleSwitch.addEventListener("change",handleWholesaleToggleChange);const cartItem=document.createElement("div");cartItem.classList.add("cart-item");const productDetails=document.createElement("div");productDetails.classList.add("product-details");productDetails.appendChild(toggleContainer);const productName=document.createElement("h5");productName.innerText=product.name;productDetails.appendChild(productName);productPrice=document.createElement("h4");productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price;productDetails.appendChild(productPrice);const quantityInput=document.createElement("input");quantityInput.type="number";quantityInput.value=1;quantityInput.min=1;quantityInput.classList.add("quantity-input");quantityInput.addEventListener("input",()=>{console.log("Input value:",quantityInput.value);const currentQuantity=parseInt(quantityInput.value);if(currentQuantity>3){toggleSwitch.checked=true;handleWholesaleToggleChange()}else{toggleSwitch.checked=false;handleWholesaleToggleChange()}const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));multiplyInputByDisplayedPrice(quantityInput.value,displayedPrice,product.name)});productDetails.appendChild(quantityInput);const deleteButton=document.createElement("button");deleteButton.innerText="Delete";deleteButton.classList.add("delete-button");deleteButton.addEventListener("click",()=>{cartItemsContainer.removeChild(cartItem);updateCartCount(-1);updateCartTotal()});productDetails.appendChild(deleteButton);cartItem.appendChild(productDetails);cartItemsContainer.appendChild(cartItem);updateCartCount(1);showAddToCartMessage(product.name);async function fetchWholesalePriceFromFirebase(productName){const productsRef=ref(database,"products/electronics");const productSnapshot=await get(child(productsRef,productName));if(productSnapshot.exists()){const wholesalePrice=productSnapshot.val().wholesalePrice;return wholesalePrice!==null?parseFloat(wholesalePrice):null}return null}let originalTotal=0;async function updatePriceBasedOnToggle(product,isWholesale){const displayedPrice=parseFloat(productPrice.innerText.replace("UGX ",""));const originalQuantity=parseInt(quantityInput.value);originalTotal=originalQuantity*displayedPrice;if(isWholesale){const wholesalePrice=await fetchWholesalePriceFromFirebase(product.name);if(wholesalePrice!==null){productPrice.innerText=`UGX ${wholesalePrice}`;productPrice.dataset.price=wholesalePrice}else{}}else{productPrice.innerText=`UGX ${product.price}`;productPrice.dataset.price=product.price}const newQuantity=parseInt(quantityInput.value);const newTotal=newQuantity*parseFloat(productPrice.dataset.price);updateTotalElement(newTotal-originalTotal);console.log("Updated Price:",parseFloat(productPrice.dataset.price))}function updateTotalElement(result){const totalPriceElement=document.getElementById("total-price");const total=parseFloat(totalPriceElement.innerText.replace("TOTAL: UGX ",""));totalPriceElement.innerText="TOTAL: UGX "+(total+result).toFixed(2);console.log("Updated Total:",total+result)}function multiplyInputByDisplayedPrice(inputValue,displayedPrice,productName){if(inputValue&&!isNaN(inputValue)){const result=inputValue*displayedPrice;productTotals[productName]=result;updateCartTotal();console.log("Result of multiplication:",result)}else{productTotals[productName]=0;updateCartTotal();console.log("Result of multiplication:",0)}}}function updateCartTotal(){const cartItems=document.getElementsByClassName("cart-item");let total=0;for(let i=0;i<cartItems.length;i++){const cartItem=cartItems[i];const quantityInput=cartItem.querySelector(".product-details .quantity-input");const productPriceElement=cartItem.querySelector(".product-details h4");const quantity=parseInt(quantityInput.value);const price=parseFloat(productPriceElement.dataset.price);const totalForItem=quantity*price;total+=totalForItem}const totalPriceElement=document.getElementById("total-price");totalPriceElement.innerText="TOTAL: UGX "+total.toFixed(2);console.log("Updated Total:",total)}function updateCartCount(count){const cartCountElement=document.getElementById("cart-count");const currentCount=parseInt(cartCountElement.innerText)||0;cartCountElement.innerText=currentCount+count}addToCartBtn.addEventListener("click",()=>{const cart=document.getElementById("cart-container");cart.style.display="block";const closeCartBtn=document.getElementById("close-cart-btn");closeCartBtn.style.display="none";setTimeout(()=>{cart.style.opacity="1"},10);addToCart(product);updateCartTotal()});card.appendChild(addToCartBtn);function showAddToCartMessage(productName){const messageContainer=document.getElementById("message-container");messageContainer.innerText=`${productName} added to cart`;messageContainer.style.display="block";setTimeout(()=>{messageContainer.style.display="none"},3e3)}const openCartBtn=document.getElementById("open-cart-btn");const closeCartBtn=document.getElementById("close-cart-btn");const cartContent=document.getElementById("cart-content");const overlay=document.getElementById("overlay4");cartContent.style.display="none";const body=document.body;openCartBtn.addEventListener("click",()=>{if(cartIsEmpty()){cartContent.style.display="none";showAddToCartMessage("Cart is Empty! Nothing is");return}overlay.style.display="block";cartContent.style.display="block";openCartBtn.style.display="none";closeCartBtn.style.display="inline-block";body.classList.add("no-scroll");setTimeout(()=>{overlay.style.opacity="1";cartContent.style.opacity="1"},10)});closeCartBtn.addEventListener("click",()=>{overlay.style.opacity="0";cartContent.style.opacity="0";setTimeout(()=>{cartContent.style.display="none";closeCartBtn.style.display="none";openCartBtn.style.display="inline-block";overlay.style.display="none";body.classList.remove("no-scroll")},300)});function cartIsEmpty(){const cartItems=document.getElementsByClassName("cart-item");return cartItems.length===0}if(isInViewportNew(card)){productsList.appendChild(card)}}loader.style.display="none"}function isInViewportNew(element){const rect=element.getBoundingClientRect();return rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)}function handleScrollNew(){const productsList=document.getElementById("products-list");const cards=document.querySelectorAll(".card1");cards.forEach(card=>{if(isInViewportNew(card)&&!productsList.contains(card)){productsList.appendChild(card)}})}window.addEventListener("scroll",handleScrollNew);function loadCardsWithRetryAndBackoff(dataRef,loadFunction,retries=5,initialDelay=3e3,maxDelay=16e3){function retryLoad(delay){setTimeout(()=>{get(dataRef).then(snapshot=>{const data=snapshot.val();if(data){loadFunction(data)}else{const nextDelay=Math.min(delay*2,maxDelay);retryLoad(nextDelay)}})["catch"](()=>{const nextDelay=Math.min(delay*2,maxDelay);retryLoad(nextDelay)})},delay)}retryLoad(initialDelay)}loadCardsWithRetryAndBackoff(electronicsRef,loadCardsNew);const slider=document.querySelector(".image-slider");const images=slider.querySelectorAll("img");const interval=3e3;let index=0;setInterval(()=>{images[index].classList.remove("active");index=(index+1)%images.length;images[index].classList.add("active")},interval);const backToTopBtn=document.getElementById("backToTopBtn");window.addEventListener("scroll",()=>{if(document.body.scrollTop>20||document.documentElement.scrollTop>20){backToTopBtn.style.display="block"}else{backToTopBtn.style.display="none"}});backToTopBtn.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})});const filterButtons=document.querySelectorAll(".filter-btn");filterButtons.forEach(button=>{button.addEventListener("click",function(){filterButtons.forEach(btn=>{btn.classList.remove("active")});this.classList.add("active");const filterValue=this.getAttribute("data-filter");filterProducts(filterValue)})});function filterProducts(filterValue){const products=document.querySelectorAll("#products-list .card1");let maxHeight=0;products.forEach(product=>{const productName=product.querySelector("h2").innerText.toLowerCase();const suggestions=filterValue.toLowerCase().split(",");const matches=suggestions.some(suggestion=>productName.includes(suggestion.trim()));if(matches||filterValue==="all"){product.style.display="block";maxHeight=Math.max(maxHeight,product.offsetHeight)}else{product.style.display="none"}});products.forEach(product=>{product.style.height=`${maxHeight}px`});const noResultsContainer=document.getElementById("no-results-container");noResultsContainer.style.display=maxHeight===0?"block":"none"}function adjustPlaceholderHeight(allProducts,visibleProducts){const placeholder=document.getElementById("placeholder");const totalProducts=allProducts.length;const visibleCount=visibleProducts.length;const hiddenCount=totalProducts-visibleCount;const cardHeight=visibleProducts[0].offsetHeight;const placeholderHeight=hiddenCount*cardHeight;placeholder.style.height=`${placeholderHeight}px`}function showNoResultsMessage(){const noResultsContainer=document.getElementById("no-results-container");noResultsContainer.style.display="block"}function hideNoResultsMessage(){const noResultsContainer=document.getElementById("no-results-container");noResultsContainer.style.display="none"}function generateRandomOrderId(length){const characters="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let result="";for(let i=0;i<length;i++){const randomIndex=Math.floor(Math.random()*characters.length);result+=characters.charAt(randomIndex)}return result}const randomOrderId=generateRandomOrderId(5);window.addEventListener("load",()=>{const savedCartDetails=localStorage.getItem("cartDetails");if(savedCartDetails){const cartDetails=JSON.parse(savedCartDetails);const customPopupContainer=document.createElement("div");customPopupContainer.classList.add("custom-popup-container");const overlay=document.createElement("div");overlay.classList.add("overlay7");const customPopupContent=document.createElement("div");customPopupContent.classList.add("custom-popup-content");const title=document.createElement("h4");title.innerText="We Saved your previous Cart Details !";customPopupContent.appendChild(title);const cartSummary=document.createElement("p");cartSummary.innerHTML=`
          <strong>Delivery Place:</strong> ${cartDetails.deliveryPlace}<br>
          <strong>Telephone Contact:</strong> ${cartDetails.telephoneNumber}<br>
          <strong>Means of Transport:</strong> ${cartDetails.meansOfTransport}<br>
          <strong>Selected Payment Option:</strong> ${cartDetails.selectedPaymentOption}<br>
          <strong>Order Summary:</strong><br>
      `;cartSummary.classList.add("cart-summary");const orderTable=document.createElement("table");orderTable.classList.add("custom-order-table");const tableHeader=document.createElement("tr");tableHeader.innerHTML=`
          <th>Pdt</th>
          <th>Price</th>
          <th>Qty</th>
          <th>Total</th>
          <th>Whole-sale</th>
      `;orderTable.appendChild(tableHeader);cartDetails.orderSummary.forEach(item=>{const row=document.createElement("tr");row.innerHTML=`
              <td>${item.productName}</td>
              <td>UGX ${item.price}</td>
              <td>${item.quantity}</td>
              <td>UGX ${item.total.toFixed(2)}</td>
              <td>${item.isWholesale?"Yes":"No"}</td>
          `;orderTable.appendChild(row)});cartSummary.appendChild(orderTable);customPopupContent.appendChild(cartSummary);const closeButton=document.createElement("button");closeButton.innerText="Close";closeButton.classList.add("close-button");closeButton.addEventListener("click",()=>{customPopupContainer.style.display="none";overlay.style.display="none"});customPopupContent.appendChild(closeButton);const placeOrderButton=document.createElement("button");placeOrderButton.innerText="Place Order";placeOrderButton.classList.add("place-order-button");placeOrderButton.addEventListener("click",async()=>{const loader=document.createElement("div");loader.classList.add("loader");customPopupContainer.appendChild(loader);const user=auth.currentUser;if(!user){showNotLoggedInMessage();return}const userId=user.uid;const userEmail=user.email;const deliveryPlace=cartDetails.deliveryPlace;const meansOfTransport=cartDetails.meansOfTransport;const selectedPaymentOption=cartDetails.selectedPaymentOption;const telephoneNumber=cartDetails.telephoneNumber;const cartTotal=cartDetails.cartTotal;const orderSummary=cartDetails.orderSummary;const orderData={orderId:generateRandomOrderId(10),orderDate:(new Date).toLocaleDateString(),orderTime:(new Date).toLocaleTimeString(),deliveryPlace:deliveryPlace,meansOfTransport:meansOfTransport,selectedPaymentOption:selectedPaymentOption,orderSummary:orderSummary,cartTotal:cartTotal,userId:userId,userEmail:userEmail,telephoneNumber:telephoneNumber};const orderRef=ref(database,"orders");const newOrderRef=push(orderRef);set(newOrderRef,orderData).then(()=>{const userReceiptRef=ref(database,`users/${userId}/receipts`);const newUserReceiptRef=push(userReceiptRef);const receiptData={orderId:orderData.orderId,orderDate:orderData.orderDate,orderTime:orderData.orderTime,deliveryPlace:orderData.deliveryPlace,meansOfTransport:orderData.meansOfTransport,selectedPaymentOption:orderData.selectedPaymentOption,orderSummary:orderData.orderSummary,cartTotal:orderData.cartTotal,userId:orderData.userId,userEmail:orderData.userEmail};set(newUserReceiptRef,receiptData).then(()=>{showSuccessPopup();clearCart()})["catch"](error=>{console.error("Error saving receipt:",error.message)})["finally"](()=>{document.body.removeChild(loaderContainer)})})["catch"](error=>{console.error("Error placing order:",error.message);document.body.removeChild(loaderContainer)})});customPopupContent.appendChild(placeOrderButton);const cancelOrderButton=document.createElement("button");cancelOrderButton.innerText="No Longer Need Order ?";cancelOrderButton.classList.add("cancel-order-button");cancelOrderButton.addEventListener("click",()=>{const confirmation=confirm("Are you sure you no longer need this order?");if(confirmation){localStorage.removeItem("cartDetails");customPopupContainer.style.display="none";overlay.style.display="none"}});customPopupContent.appendChild(cancelOrderButton);customPopupContainer.appendChild(customPopupContent);document.body.appendChild(overlay);document.body.appendChild(customPopupContainer);const viewDraftOrdersBtn=document.getElementById("viewDraftOrdersBtn");viewDraftOrdersBtn.addEventListener("click",()=>{customPopupContainer.style.display="block";overlay.style.display="block"})}});function removeLoaderContainer(){const loaderContainer=document.querySelector(".loader-container");if(loaderContainer){document.body.removeChild(loaderContainer)}}function showSuccessPopup(){removeLoaderContainer();const successPopup=document.createElement("div");successPopup.classList.add("success-popup");const successMessage=document.createElement("h3");const successText=document.createElement("p");successText.innerText="Thank you for shopping with us... You can always find your receipts in your account and use ORDER IDs as reasons for payment. Thank you.";successMessage.innerText="Order Successful !";const okayButton=document.createElement("button");okayButton.classList.add("okay-button");okayButton.innerText="Okay";successPopup.appendChild(okayButton);okayButton.addEventListener("click",()=>{localStorage.removeItem("cartDetails");location.reload();document.body.removeChild(successPopup)});successPopup.appendChild(successMessage);successPopup.appendChild(successText);successPopup.appendChild(okayButton);document.body.appendChild(successPopup)}